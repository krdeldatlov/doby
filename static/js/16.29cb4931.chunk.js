(this.webpackJsonpkd=this.webpackJsonpkd||[]).push([[16],{614:function(e,t,n){"use strict";var a=n(13);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(2)),i=(0,a(n(142)).default)(r.default.createElement(r.default.Fragment,null,r.default.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}),r.default.createElement("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})),"Check");t.default=i},626:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n(2),i=n.n(r),c=n(7),s=n(5),l=n.n(s),o=n(3),u=n.n(o),d=n(6),f=n(18),p=n(19),m=n(21),b=n(20),h=n(522),v=n(8),x=n(16),j=n(168),g=n(0),O=function(e){Object(m.a)(n,e);var t=Object(b.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).callBack=function(e,t){r.setState({[e]:t})},r.getImage=Object(d.a)(u.a.mark((function e(){var t,n,i,c,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.state._img){e.next=2;break}return e.abrupt("return");case 2:return t=r.props,n=t.doby,i=t.data,c=t.imgId,s=t.propName,e.next=5,n.getImage_Climb(i,c,s,!0);case 5:l=e.sent,r.setState((function(e){return Object(a.a)({},l)}));case 7:case"end":return e.stop()}}),e)}))),r.state={_img:null},r}return Object(p.a)(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.propName;return this.getImage(),Object(g.jsx)("div",{children:Object(g.jsx)("img",{src:this.state[n],alt:"Attached",className:t.img,onClick:this.props.onClick})})}}]),n}(i.a.Component),y=Object(v.a)(x.a,Object(c.withStyles)((function(e){return Object(a.a)(Object(a.a)({},Object(j.a)(e)),{},{img:{"max-width":"150px","max-height":"150px",margin:"5px",cursor:"pointer"}})})))(O),k=n(614),w=n.n(k),C=n(77),_=n.n(C),I=n(11),V=n(26),S=n(47),D=n(80),N=n(30),L=n.n(N),M=n(9),R={field:"created",dir:"desc"},A=function(e){Object(m.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(f.a)(this,n),(a=t.call(this,e)).getSubtitle=function(e){var t,n,r,i=a.props.translate,c="".concat(null===e||void 0===e||null===(t=e.summit)||void 0===t?void 0:t.elevation," ").concat(i("units.metersAboveSea")),s="".concat(null===e||void 0===e?void 0:e.count,"/").concat(null===e||void 0===e||null===(n=e.challenge)||void 0===n||null===(r=n.summitsRef)||void 0===r?void 0:r.length," ").concat(0===(null===e||void 0===e?void 0:e.count)?i("challenge.summit_gen"):1===(null===e||void 0===e?void 0:e.count)?i("challenge.summit"):(null===e||void 0===e?void 0:e.count)<5?i("challenge.summits"):i("challenge.summit_gen")),l=L()(null===e||void 0===e?void 0:e.date).format("DD.MM.YY");return"".concat(c," | ").concat(s," | ").concat(l)},a.sendMail=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var r,i,c,s,l,o,f,p,m,b,h,v,x,j,g,O,y;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.userRef,i=t._id,c=t.challenge,s=t.summit,l=t.images,o=t.imageId,f=a.props.translate,p="",m=0,b=1,h=[],v=[],x=!1,j="/newsfeed/"+i,!n){e.next=11;break}p=(p=(p=f("email_climbDeleted_subject")).replace("{0}",c.name)).replace("{1}",s.name),m=M.a.mail.climbDeletedTemplate,h=[c.name,s.name],e.next=24;break;case 11:if(p=(p=f("email_climbVerified_subject")).replace("{0}",s.name),m=M.a.mail.climbVerifiedTemplate||0,b=M.a.mail.climbVerifiedTemplate?0:1,g="",0!==b){e.next=20;break}return e.next=19,Promise.all(l.map(function(){var e=Object(d.a)(u.a.mark((function e(n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,x){e.next=6;break}return e.next=4,a.props.doby.getShareImageFile(n.id,c.logoId,s.name,a.getSubtitle(t));case 4:(r=e.sent)?n.id===o&&(g=r):x=!0;case 6:return e.abrupt("return",{id:r});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:v=e.sent;case 20:return e.next=22,a.props.user.getUser(r.id);case 22:O=e.sent,h=[M.a.url.doby+"/api/file/"+c.logoId,null===O||void 0===O?void 0:O.name.split(" ")[0],s.name,M.a.url.doby+"/api/file/"+g,"https://doby.krdeldatlov.sk"+j];case 24:return y={subject:p,from:M.a.mail.address,fromName:M.a.mail.name,recipientRef:{id:r.id},filesRef:v,ru:j,templateId:m,type:b,params:h},e.next=27,a.props.mail.sendMail(y);case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.handleSendNotification=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,i,c,s=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]&&s[1],!t.userRef||!t.userRef.id){e.next=9;break}return e.next=4,a.props.doby.getUser(t.userRef.id,!0);case 4:r=e.sent,i=!1,r&&(c=r.meta,i=c&&c.disableNotifications&&"1"===c.disableNotifications),i||console.log(a.props,t),a.sendMail(t,n);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleVerifyClimb=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props.doby,r=n.verifyClimb,i=n.refreshClimbs,e.prev=1,e.next=4,r(t._id);case 4:return i(),e.next=7,a.handleSendNotification(t);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),a.props.user.showError(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),a.handleDeleteClimb=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props.doby,r=n.deleteClimb,i=n.refreshClimbs,e.prev=1,e.next=4,r(t._id);case 4:return i(),e.next=7,a.handleSendNotification(t,!0);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),a.props.user.showError(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),a.handleSummitVerifyBtn=function(e){var t=a.props,n=t.translate,r=t.classes;return Object(g.jsxs)("div",{className:r.summitVerifyBtnContainer,children:[e.summit.name,Object(g.jsx)(_.a,{variant:"contained",color:"primary",disabled:null!==e.verified,onClick:function(){return a.handleVerifyClimb(e)},children:n("verify")})]})},a.getAvatar=function(e){var t=a.props.classes;return e.user&&e.user.avatar?Object(g.jsx)("div",{children:Object(g.jsx)("img",{src:"data:image/jpeg;base64,"+e.user.avatar,alt:"Attached",className:t.avatar})}):Object(g.jsx)(g.Fragment,{})},a.generateRows=function(){return[{field:"avatar",cell:a.getAvatar,disablePadding:!0,filterable:!1},{field:"summit_name/action",cell:a.handleSummitVerifyBtn,filterable:!1},{field:"summit_images",cell:a.handleImages,filterable:!1},{field:"user",cell:a.handleUserData,filterable:!1},{field:"created",type:"datetime"},{field:"verified",type:"datetime"},{field:"isVerified",type:"bool",cell:a.isVerified},{field:"_id"}]},a.handleImages=function(e){var t=a.props.classes,n=e.thumbnails;return Object(g.jsx)("div",{className:t.imagesContainer,children:n.map((function(n,r){return Object(g.jsx)(y,{classes:t,data:n,imgId:"id",propName:"_img",onClick:function(){return a.handleLightboxOpen(r,e)}})}))})},a.isVerified=function(e){return null!==e.verified?"T":"F"},a.handleUserData=function(e){var t=e.user,n=t.email,r=t.name,i=t._id,c=a.props.translate;return Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{children:"".concat(c("field.username"),": ").concat(r)}),Object(g.jsx)("div",{children:"".concat(c("field.email"),": ").concat(n)}),Object(g.jsx)("div",{children:"".concat(c("field._id"),": ").concat(i)})]})},a.handleDelete=function(){var e=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=a.props.doby.climbs.data.find((function(e){return e._id===t})))){e.next=4;break}return e.next=4,a.handleDeleteClimb(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleLightboxOpen=function(e,t){a.setState((function(n){return{isLightboxOpen:!0,currentImgIndex:e,x:t}}))},a.handleLightboxClose=function(){a.setState({isLightboxOpen:!1})},a.handleChange=function(){var e=Object(d.a)(u.a.mark((function e(t,n,r,i){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=t.find((function(e){return"isVerified"===e.field})),e.next=4,a.props.doby.getClimbs(t.filter((function(e){return"isVerified"!==e.field})),r,n,i,c?{isVerified:c.value}:{});case 4:return e.abrupt("return",e.sent);case 7:e.prev=7,e.t0=e.catch(0),a.props.user.showError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,a,r){return e.apply(this,arguments)}}(),a.handleVerifyMultiple=function(){var e=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||0!==t.length){e.next=2;break}return e.abrupt("return");case 2:return n=a.props.doby.climbs.data,e.prev=3,e.next=6,Promise.all(t.map(function(){var e=Object(d.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=n.find((function(e){return e._id===t})))||null!==r.verified){e.next=4;break}return e.next=4,a.handleVerifyClimb(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),a.props.user.showError(e.t0);case 11:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t){return e.apply(this,arguments)}}(),a.genActions=function(){return[{tooltipTitle:(0,a.props.translate)("verify"),iconButton:{label:"Label",color:"primary",onClick:a.handleVerifyMultiple,icon:Object(g.jsx)(w.a,{})}}]},a.isDisabled=function(e){return!1},a.state={x:null,isLightboxOpen:!1,currentImgIndex:null},a}return Object(p.a)(n,[{key:"render",value:function(){var e=this.state,t=e.isLightboxOpen,n=e.currentImgIndex,a=e.x,r=this.props.translate;return Object(g.jsxs)("div",{children:[Object(g.jsx)(h.a,{rows:this.generateRows(),data:"climbs",onChange:this.handleChange,title:r("climbs"),actions:this.genActions(),onDelete:this.handleDelete,store:this.props.doby,filters:[],isDisabled:this.isDisabled,defaultSort:R}),t&&Object(g.jsx)(D.a,{images:a&&a.images,imageIndex:n,onClose:this.handleLightboxClose})]})}}]),n}(i.a.Component),E=Object(v.a)(x.a,V.a,S.a,I.b,Object(c.withStyles)((function(e){return Object(a.a)(Object(a.a)({},Object(j.a)(e)),{},{avatar:{"max-width":"50px","max-height":"50px"},imagesContainer:{display:"flex","flex-direction":"row","align-items":"center"},summitVerifyBtnContainer:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"space-around"}})})))(A),B=n(10);t.default=Object(v.a)(Object(c.withStyles)((function(e){return Object(a.a)(Object(a.a)({},Object(B.a)(e)),{},{paper:{padding:e.spacing.unit}})})),V.a)((function(e){var t=e.classes;return Object(g.jsx)(l.a,{container:!0,children:Object(g.jsx)(l.a,{item:!0,xs:12,className:t.p2,children:Object(g.jsx)(E,{})})})}))}}]);